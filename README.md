# Flowturi Real-Time Sandbox

A self-contained Flink + WebSocket bridge + Flowturi Studio demo for real-time Sankey diagram streaming.

---

## ğŸ“¦ Features

- Apache Flink (optional future) streaming synthetic data generator
- Node.js WebSocket bridge (serves data to Flowturi Studio)
- Real-time data simulated by synthetic generator script
- Docker Compose setup for local testing
- Portable, no host installation required

---

## ğŸ§± Project Structure

```
flowturi-realtime-sandbox/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ flink/                 # (Optional future: Flink job loader)
â”œâ”€â”€ bridge/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ bridge.js
â”‚   â”œâ”€â”€ synthetic.js
â”‚   â”œâ”€â”€ stream.json
â”‚   â””â”€â”€ watch.js           # ğŸ†• WS viewer script
â””â”€â”€ README.md
```

---

## ğŸš€ Quickstart

1. Clone this repo:

```bash
git clone https://github.com/your-user/flowturi-realtime-sandbox.git
cd flowturi-realtime-sandbox
```

2. Start the services:

```bash
docker-compose up
```

3. Open the Flink dashboard (optional):
   â¡ï¸ [http://localhost:8081](http://localhost:8081)

4. Open Flowturi Studio (must support real-time mode) and connect to:

```
ws://localhost:8082
```

5. Or use a local watcher script:

```bash
node bridge/watch.js
```

---

## ğŸ”§ WebSocket Bridge with Generator

### `bridge.js`

Watches `stream.json` for changes and broadcasts updated Sankey data to WebSocket clients.

### `synthetic.js`

Writes realistic but random flow data to `stream.json` every 0.5 seconds.

#### ğŸ§  `tick`

The `tick` field increments with every update and acts as a frame counter â€” useful for animations and time-based syncing in Flowturi Studio.

### `watch.js`

Minimal client to connect and print all WebSocket data:

```js
const WebSocket = require("ws");
const ws = new WebSocket("ws://localhost:8082");

ws.on("open", () => console.log("âœ… Connected"));
ws.on("message", (data) => {
  try {
    const parsed = JSON.parse(data);
    console.log(JSON.stringify(parsed, null, 2));
  } catch (e) {
    console.warn("âš ï¸ Bad message:", data.toString());
  }
});
```

---

## ğŸ§ª Testing Without Flink

No need to install Flink yet â€” synthetic data is generated by `synthetic.js`.

Example payload:

```json
{
  "timestamp": 1715558023737,
  "tick": 4,
  "nodes": [ ... ],
  "links": [ ... ]
}
```

---

## ğŸ“„ `docker-compose.yml`

```yaml
version: "3"
services:
  websocket-bridge:
    build: ./bridge
    ports:
      - "8082:8082"
```

---

## ğŸ³ `bridge/Dockerfile`

```Dockerfile
FROM node:18
WORKDIR /app
COPY package.json ./
RUN npm install
RUN npm install npm-run-all
COPY bridge.js stream.json synthetic.js watch.js ./
CMD ["npm", "run", "start"]
```

---

## ğŸ§° `package.json`

```json
{
  "name": "flowturi-bridge",
  "version": "1.0.0",
  "main": "bridge.js",
  "dependencies": {
    "ws": "^8.0.0"
  },
  "devDependencies": {
    "npm-run-all": "^4.1.5"
  },
  "scripts": {
    "generate": "node synthetic.js",
    "bridge": "node bridge.js",
    "start": "run-p generate bridge",
    "watch": "node watch.js"
  }
}
```

---

## ğŸ§¼ Cleanup

```bash
docker-compose down
```

---

## ğŸ™Œ Credits

- [Flowturi](https://github.com/ThatOrJohn/flowturi)
- Apache Flink
- ws (WebSocket lib for Node.js)
- npm-run-all

---

MIT License
