# Flowturi Real-Time Sandbox

A self-contained Flink + WebSocket bridge + Flowturi Studio demo for real-time Sankey diagram streaming.

---

## 📦 Features

- Apache Flink (optional future) streaming synthetic data generator
- Node.js WebSocket bridge (serves data to Flowturi Studio)
- Real-time data simulated by synthetic generator script
- Docker Compose setup for local testing
- Portable, no host installation required

---

## 🧱 Project Structure

```
flowturi-realtime-sandbox/
├── docker-compose.yml
├── flink/                 # (Optional future: Flink job loader)
├── bridge/
│   ├── Dockerfile
│   ├── package.json
│   ├── bridge.js
│   ├── synthetic.js
│   ├── stream.json
│   └── watch.js           # 🆕 WS viewer script
└── README.md
```

---

## 🚀 Quickstart

1. Clone this repo:

```bash
git clone https://github.com/your-user/flowturi-realtime-sandbox.git
cd flowturi-realtime-sandbox
```

2. Start the services:

```bash
docker-compose up
```

3. Open the Flink dashboard (optional):
   ➡️ [http://localhost:8081](http://localhost:8081)

4. Open Flowturi Studio (must support real-time mode) and connect to:

```
ws://localhost:8082
```

5. Or use a local watcher script:

```bash
node bridge/watch.js
```

---

## 🔧 WebSocket Bridge with Generator

### `bridge.js`

Watches `stream.json` for changes and broadcasts updated Sankey data to WebSocket clients.

### `synthetic.js`

Writes realistic but random flow data to `stream.json` every 0.5 seconds.

#### 🧠 `tick`

The `tick` field increments with every update and acts as a frame counter — useful for animations and time-based syncing in Flowturi Studio.

### `watch.js`

Minimal client to connect and print all WebSocket data:

```js
const WebSocket = require("ws");
const ws = new WebSocket("ws://localhost:8082");

ws.on("open", () => console.log("✅ Connected"));
ws.on("message", (data) => {
  try {
    const parsed = JSON.parse(data);
    console.log(JSON.stringify(parsed, null, 2));
  } catch (e) {
    console.warn("⚠️ Bad message:", data.toString());
  }
});
```

---

## 🧪 Testing Without Flink

No need to install Flink yet — synthetic data is generated by `synthetic.js`.

Example payload:

```json
{
  "timestamp": 1715558023737,
  "tick": 4,
  "nodes": [ ... ],
  "links": [ ... ]
}
```

---

## 📄 `docker-compose.yml`

```yaml
version: "3"
services:
  websocket-bridge:
    build: ./bridge
    ports:
      - "8082:8082"
```

---

## 🐳 `bridge/Dockerfile`

```Dockerfile
FROM node:18
WORKDIR /app
COPY package.json ./
RUN npm install
RUN npm install npm-run-all
COPY bridge.js stream.json synthetic.js watch.js ./
CMD ["npm", "run", "start"]
```

---

## 🧰 `package.json`

```json
{
  "name": "flowturi-bridge",
  "version": "1.0.0",
  "main": "bridge.js",
  "dependencies": {
    "ws": "^8.0.0"
  },
  "devDependencies": {
    "npm-run-all": "^4.1.5"
  },
  "scripts": {
    "generate": "node synthetic.js",
    "bridge": "node bridge.js",
    "start": "run-p generate bridge",
    "watch": "node watch.js"
  }
}
```

---

## 🧼 Cleanup

```bash
docker-compose down
```

---

## 🙌 Credits

- [Flowturi](https://github.com/ThatOrJohn/flowturi)
- Apache Flink
- ws (WebSocket lib for Node.js)
- npm-run-all

---

MIT License
